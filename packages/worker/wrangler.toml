name = "nimbus-worker"
main = "src/index.ts"
compatibility_date = "2025-01-21"
compatibility_flags = ["nodejs_compat"]

# Enable workers.dev access
workers_dev = true

# Custom domain for preview URLs (wildcard DNS required)
[[routes]]
pattern = "*.getnimbus.dev/*"
zone_name = "getnimbus.dev"

[vars]
DEFAULT_MODEL = "anthropic/claude-sonnet-4"

# D1 Database for job persistence
[[d1_databases]]
binding = "DB"
database_name = "nimbus-db"
database_id = "b0c22993-0a1a-4117-8ffb-f243e7487c05"

[[r2_buckets]]
binding = "LOGS_BUCKET"
bucket_name = "nimbus-logs"

# Sandbox container configuration
# Using standard-2 for more memory/disk (needed for framework installs like Astro, Next.js)
[[containers]]
class_name = "Sandbox"
image = "./Dockerfile"
instance_type = "standard-2"

[durable_objects]
bindings = [{ name = "Sandbox", class_name = "Sandbox" }]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["Sandbox"]

[observability.logs]
enabled = true
invocation_logs = true
